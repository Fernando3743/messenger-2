(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{34:function(e,t,s){},42:function(e,t,s){"use strict";s.r(t);var n=s(0),c=s.n(n),a=s(18),r=s.n(a),l=(s(34),s(27)),o=s(3),i=s(5),u=s(11),d=s(1);var b=function(){return Object(d.jsx)("div",{className:"hidden md:flex-1 md:grid place-items-center",children:Object(d.jsx)(u.a,{className:"h-60 text-gray-500"})})},m=s(13),j=s(10);var x=function(e){var t=e.user,s=e.sender,n=e.message;return Object(d.jsx)("div",{className:"max-w-2xl p-4 rounded-3xl my-3 ".concat(s.id===t.id?"ml-auto bg-blue-500":"mr-auto bg-gray-100"),children:Object(d.jsx)("p",{children:n})})},h=s(9),f="ADD_CHATS",p="ADD_USER",O="OPEN_CHAT",g="CLOSE_CHAT",v="ADD_MESSAGE",w="NEW_CHAT";var y=function(e){var t=e.chatID,s=e.messages,c=e.user,a=e.opened,r=e.user2,l=Object(n.useRef)(null),o=Object(n.useState)(null),b=Object(m.a)(o,2),h=b[0],f=b[1],p=Object(i.b)();Object(n.useEffect)((function(){var e=new WebSocket("ws://"+window.location.host+"/ws/chat/"+t+"/");e.removeEventListener(onmessage,O),e.onmessage=O,f(e)}),[t]);var O=function(e){console.log(e.data),console.log(typeof e.data),console.log(JSON.parse(e.data).message),p(function(e){var t=e.chatID,s=e.message;return{type:v,payload:{chatID:t,message:s}}}({chatID:t,message:JSON.parse(e.data).message}))},w=function(){""!==l.current.value&&(h.send(JSON.stringify({message:l.current.value})),l.current.value="")};return Object(d.jsx)("div",{className:"flex-1 pr-4 ".concat(!a&&"hidden"),children:Object(d.jsxs)("div",{className:"flex flex-col h-screen relative",children:[Object(d.jsxs)("div",{className:"flex items-center p-2 h-20 bg-white",children:[Object(d.jsx)(j.a,{onClick:function(){return p({type:g,payload:t})},className:"blueIcon ml-3"}),Object(d.jsxs)("h1",{className:"mx-auto font-bold text-2xl",children:[r.email,"'s chat"]}),Object(d.jsxs)("div",{className:"flex items-center space-x-2",children:[Object(d.jsx)(j.f,{className:"blueIcon"}),Object(d.jsx)(j.h,{className:"blueIcon"}),Object(d.jsx)(u.b,{className:"blueIcon"})]})]}),Object(d.jsx)("div",{className:"flex-1 flex flex-col-reverse overflow-y-scroll scrollbar-hide",children:s.length>0&&s.map((function(e){return Object(d.jsx)(x,{user:c,sender:e.user,message:e.message},e.id)}))}),Object(d.jsxs)("div",{className:"flex h-16 items-center space-x-3 px-2",children:[Object(d.jsxs)("div",{className:"flex-1 flex items-center bg-gray-100 h-12 rounded-3xl px-3",children:[Object(d.jsx)("input",{className:"outline-none bg-transparent flex-1",type:"text",ref:l,onKeyDown:function(e){13===e.keyCode&&w()},placeholder:"Type your message here"}),Object(d.jsx)(j.c,{onClick:w,className:"blueIcon"})]}),Object(d.jsxs)("div",{className:"flex space-x-2",children:[Object(d.jsx)(j.b,{className:"blueIcon"}),Object(d.jsx)(j.g,{className:"blueIcon"}),Object(d.jsx)(j.e,{className:"blueIcon"}),Object(d.jsx)(j.d,{className:"blueIcon"})]})]})]})})},N=s(15),k=s.n(N),S=s(21);function I(e){var t=null;if(document.cookie&&""!==document.cookie)for(var s=document.cookie.split(";"),n=0;n<s.length;n++){var c=s[n].trim();if(c.substring(0,e.length+1)===e+"="){t=decodeURIComponent(c.substring(e.length+1));break}}return t}var C=function(e){var t=e.username,s=e.image,n=e.message,c=e.id,a=Object(i.b)();return Object(d.jsxs)("div",{onClick:function(){return a(function(e){return{type:O,payload:e}}(c))},className:"flex items-center space-x-3 p-1 my-4 transform transition duration-500 ease-in-out hover:scale-105 cursor-pointer",children:[Object(d.jsx)("img",{className:"h-16 w-16 rounded-full object-cover",src:s,alt:"Profile Pic"}),Object(d.jsxs)("div",{className:"truncate overflow-hidden",children:[Object(d.jsx)("h1",{className:"font-bold text-xl",children:t}),Object(d.jsx)("p",{className:"text-lg text-gray-500 truncate",children:n})]})]})};var D=function(e){var t=e.chats,s=e.user,n=e.openedChat,c=Object(i.b)(),a=function(){var e=Object(S.a)(k.a.mark((function e(){var t,s,n;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=prompt("Write user's username you wanna chat with"),s=I("csrftoken"),n=new Request("/new_chat",{headers:{"X-CSRFToken":s}}),e.next=5,fetch(n,{method:"POST",body:JSON.stringify({username:t})}).then((function(e){return e.json()})).then((function(e){var t;e.error?alert(e.error):(console.log(e.message),c((t=e.chat,{type:w,payload:t})))}));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.jsxs)("div",{className:"px-4 ".concat(n?"hidden":"flex"," md:flex flex-col w-full md:max-w-[400px] lg:min-w-[500px] h-screen"),children:[Object(d.jsxs)("div",{className:"flex justify-between p-2 rounded-b-2xl h-20 items-center",children:[Object(d.jsx)("a",{href:"/logout",children:Object(d.jsx)("img",{src:null===s||void 0===s?void 0:s.image,alt:"User's profile",className:"h-14 w-14 rounded-full object-cover"})}),Object(d.jsx)("h1",{className:"font-bold text-2xl",children:null===s||void 0===s?void 0:s.email}),Object(d.jsx)(u.c,{onClick:a,className:"blueIcon"})]}),Object(d.jsxs)("div",{className:"flex items-center mt-2 p-2 h-15 shadow-lg rounded-xl w-full space-x-2",children:[Object(d.jsx)(u.d,{className:"h-6 text-gray-400"}),Object(d.jsx)("input",{placeholder:"Search Messages",type:"text",className:"h-8 w-full outline-none text-lg"})]}),Object(d.jsx)("div",{className:"flex-1 overflow-y-scroll scrollbar-hide",children:t.length>0&&Object.keys(s)&&t.map((function(e){var t,n=e.user1.id===s.id?e.user2:e.user1,c=n.username,a=n.image,r=(null===(t=e.messages[0])||void 0===t?void 0:t.message)||null;return Object(d.jsx)(C,{id:e.id,username:c,image:a,message:r},e.id)}))})]})};var R=function(){var e=Object(i.c)((function(e){return e.chats})),t=Object(i.c)((function(e){return e.user})),s=Object(i.c)((function(e){return Boolean(e.chats.filter((function(e){return e.open})).length)})),c=Object(i.b)();return console.log(s),Object(n.useEffect)((function(){fetch("".concat("http://127.0.0.1:8000","/chats")).then((function(e){return e.json()})).then((function(e){c(function(e){return{type:f,payload:e.map((function(e){return Object(h.a)(Object(h.a)({},e),{},{open:!1})}))}}(e))})),fetch("".concat("http://127.0.0.1:8000","/user")).then((function(e){return e.json()})).then((function(e){c(function(e){return{type:p,payload:e}}(e))})),console.log("Calling use effect")}),[]),Object(d.jsxs)("div",{className:"flex",children:[Object(d.jsx)(D,{openedChat:s,user:t,chats:e}),Boolean(null===e||void 0===e?void 0:e.length)&&e.map((function(e){var s=e.user1.id===t.id?e.user2:e.user1;return Object(d.jsx)(y,{chatID:e.id,opened:e.open,user:t,user2:s,messages:e.messages})})),!s&&Object(d.jsx)(b,{})]})},U=s.p+"static/media/messenger.54e2c7f7.png";var E=function(){var e=Object(o.f)(),t=Object(n.useState)(""),s=Object(m.a)(t,2),c=s[0],a=s[1],r=Object(n.useRef)(null),l=Object(n.useRef)(null),i=function(){var t=Object(S.a)(k.a.mark((function t(s){var n,c,o,i,u,d;return k.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s.preventDefault(),n=I("csrftoken"),console.log("http://127.0.0.1:8000"),c=new Request("".concat("http://127.0.0.1:8000","/login"),{headers:{"X-CSRFToken":n}}),t.next=6,fetch(c,{method:"POST",body:JSON.stringify({username:r.current.value,password:l.current.value})});case 6:return o=t.sent,t.next=9,o;case 9:return i=t.sent.redirected,t.next=12,o;case 12:if(u=t.sent,console.log(u,i),!i){t.next=18;break}e.push("/"),t.next=28;break;case 18:return t.next=20,o;case 20:return d=t.sent.json(),t.t0=a,t.next=24,d;case 24:t.t1=t.sent.message,(0,t.t0)(t.t1),r.current.value="",l.current.value="";case 28:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(d.jsxs)("div",{className:"flex",children:[Object(d.jsx)("div",{className:"hidden md:grid w-2/5 h-screen place-items-center",children:Object(d.jsx)("img",{className:"h-80 w-80",src:U,alt:"Messenger Logo"})}),Object(d.jsx)("div",{className:"w-full md:w-1/2 h-screen flex items-center p-5 md:p-20",children:Object(d.jsx)("div",{className:"w-full",children:Object(d.jsxs)("form",{className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",method:"post",action:"/login",onSubmit:i,children:[Object(d.jsx)("p",{className:"text-red-500 text-xs md:text-base italic",children:c}),Object(d.jsxs)("div",{className:"mb-4",children:[Object(d.jsx)("label",{className:"block text-gray-700 text-sm md:text-lg font-bold mb-2",htmlFor:"username",children:"Username"}),Object(d.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",autoFocus:!0,id:"username",ref:r,type:"text",placeholder:"Username"})]}),Object(d.jsxs)("div",{className:"mb-6",children:[Object(d.jsx)("label",{className:"block text-gray-700 text-sm md:text-lg font-bold mb-2",htmlFor:"password",children:"Password"}),Object(d.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline",id:"password",type:"password",ref:l,placeholder:"******************"})]}),Object(d.jsxs)("div",{className:"flex items-center justify-between",children:[Object(d.jsx)("input",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"submit",value:"Sign In"}),Object(d.jsx)("a",{className:"inline-block align-baseline font-bold text-sm text-blue-500 hover:text-blue-800",href:"/register",children:"Sign Up"})]})]})})})]})};var F=function(){var e=Object(o.f)(),t=Object(n.useState)(""),s=Object(m.a)(t,2),c=s[0],a=s[1],r=Object(n.useRef)(null),l=Object(n.useRef)(null),i=Object(n.useRef)(null),u=Object(n.useRef)(null),b=Object(n.useRef)(null);return Object(d.jsx)("div",{children:Object(d.jsxs)("div",{className:"flex",children:[Object(d.jsx)("div",{className:"hidden md:grid w-2/5 h-screen place-items-center",children:Object(d.jsx)("img",{className:"h-80 w-80",src:U,alt:"Messenger Logo"})}),Object(d.jsx)("div",{className:"w-full md:w-1/2 h-screen flex items-center p-5 md:p-20",children:Object(d.jsx)("div",{className:"w-full",children:Object(d.jsxs)("form",{className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",onSubmit:function(t){t.preventDefault();var s=I("csrftoken"),n=new Request("".concat("http://127.0.0.1:8000","/register"),{headers:{"X-CSRFToken":s}});fetch(n,{method:"POST",body:JSON.stringify({username:r.current.value,email:l.current.value,image:i.current.value,password:u.current.value,confirmation:b.current.value})}).then((function(t){if(!t.redirected)return t.json();e.push("/")})).then((function(e){e.message&&a(e.message),r.current.value="",l.current.value="",u.current.value="",b.current.value=""}))},children:[Object(d.jsx)("p",{className:"text-red-500 text-xs md:text-base italic",children:c}),Object(d.jsxs)("div",{className:"mb-4",children:[Object(d.jsx)("label",{className:"block text-gray-700 text-sm md:text-lg font-bold mb-2",htmlFor:"username",children:"Username"}),Object(d.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",autoFocus:!0,id:"username",ref:r,type:"text",placeholder:"Username"})]}),Object(d.jsxs)("div",{className:"mb-4",children:[Object(d.jsx)("label",{className:"block text-gray-700 text-sm md:text-lg font-bold mb-2",htmlFor:"email",children:"Email Address"}),Object(d.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"email",ref:l,type:"email",placeholder:"Email Address"})]}),Object(d.jsxs)("div",{className:"mb-4",children:[Object(d.jsx)("label",{className:"block text-gray-700 text-sm md:text-lg font-bold mb-2",htmlFor:"imageUrl",children:"Image Url"}),Object(d.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"imageUrl",ref:i,type:"text",placeholder:"Image Url"})]}),Object(d.jsxs)("div",{className:"mb-4",children:[Object(d.jsx)("label",{className:"block text-gray-700 text-sm md:text-lg font-bold mb-2",htmlFor:"password",children:"Password"}),Object(d.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"password",ref:u,type:"password",placeholder:"******************"})]}),Object(d.jsxs)("div",{className:"mb-6",children:[Object(d.jsx)("label",{className:"block text-gray-700 text-sm md:text-lg font-bold mb-2",htmlFor:"confirmation",children:"Confirm Password"}),Object(d.jsx)("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 mb-3 leading-tight focus:outline-none focus:shadow-outline",id:"confirmation",type:"password",ref:b,placeholder:"******************"})]}),Object(d.jsxs)("div",{className:"flex items-center justify-between",children:[Object(d.jsx)("input",{className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"submit",value:"Sign Up"}),Object(d.jsxs)("div",{children:["Already have an account? ","   ",Object(d.jsx)("a",{className:"inline-block align-baseline font-bold text-sm text-blue-500 hover:text-blue-800",href:"/login",children:"Sign In"})]})]})]})})})]})})};var T=function(){return Object(d.jsx)(l.a,{children:Object(d.jsxs)(o.c,{children:[Object(d.jsx)(o.a,{exact:!0,path:"/",component:R}),Object(d.jsx)(o.a,{exact:!0,path:"/login",component:E}),Object(d.jsx)(o.a,{exact:!0,path:"/register",component:F})]})})},A=s(14),P=s(22),J=Object(A.combineReducers)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case p:return t.payload;default:return e}},chats:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case f:return t.payload;case O:return e.map((function(e){return e.id===t.payload?Object(h.a)(Object(h.a)({},e),{},{open:!0}):Object(h.a)(Object(h.a)({},e),{},{open:!1})}));case g:return e.map((function(e){return e.id===t.payload?Object(h.a)(Object(h.a)({},e),{},{open:!1}):e}));case v:var s=e.filter((function(e){return e.id!==t.payload.chatID})),n=e.filter((function(e){return e.id===t.payload.chatID}))[0],c=Object(h.a)(Object(h.a)({},n),{},{messages:[t.payload.message].concat(Object(P.a)(n.messages))});return[c].concat(Object(P.a)(s));case w:return[t.payload].concat(Object(P.a)(e));default:return e}}}),_=s(28),M=s(29),H=Object(A.createStore)(J,Object(M.composeWithDevTools)(Object(A.applyMiddleware)(_.a)));r.a.render(Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(i.a,{store:H,children:Object(d.jsx)(T,{})})}),document.getElementById("root"))}},[[42,1,2]]]);
//# sourceMappingURL=main.0c7208fe.chunk.js.map